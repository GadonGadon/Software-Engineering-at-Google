# Build Systems and Build Philosophy 빌드 시스템 및 빌드 철학

### Introduction

구글 직원들이 일할 때 가장 만족도 높은 부분이 놀랍게도 구글의 빌드 시스템이다. 구글은 빌드 시스템에 막대한 시간을 쏟았고 그 결과는 매우 성공적이다.

### 빌드 시스템의 목적

빌드 시스템의 목적은 엔지니어가 쓴 코드를 기계가 읽고 실행할 수 있도록 변환해주는 것이다. 좋은 빌드 시스템은 다음과 같이 두 가지를 최적화 한다.

1. Fast(속도): 엔지니어는 몇 초안에 결과를 얻어야 한다.
2. Correct(정확도): 인풋이 똑같다면 결과는 항상 같아야 한다. 

빌드 시스템은 단순히 사람만을 위한 것은 아니다. 구글에서는 자동으로 빌드하고 테스트하고 출시할 수 있다. 사실 많은 코드들이 구글에서 자동으로 실행되고 있다. 

예시

- 코드가 자동으로 빌드되고 테스트되고 프로덕션까지 사람의 개입없이 이루어진다.
- 코드 변화가 생기면 자동으로 테스트 되고 코드 리뷰를 할 수 있도록 바로 보내진다.
- 변화된 코드를 합치기 전에  자동으로 테스트 된다.
- 하위 레벨 라이브러리 작성자는 코드 변경사항을 테스트 할 수 있다
- 엔지니어는 큰 스케일의 코드 변화도 가능하다.

## 빌드 시스템이 없을 때 무엇이 발생하는가?

### 컴파일러로 충분하지 않나?

빌드 시스템의 필요성을 즉각적으로 드러나지 않을 수 있다. 하지만 코드가 확장되고 복잡해지면서 단순히 하나의 랭귀지가 아닌 다양한 랭귀지를 써야되게 될 경우가 생긴다. 우리의 코드가 어디에 의존하는지 생각해야 하고 모든 부분들이 올바른 순서데로 되어있는지 알아야 한다. 컴플라이어는 외부 디펜던시를 다룰 수 없다. 빌드 시스템이 없이는 디펜던시를 다운받거나 하드 드라이브에 넣어둬야 한다. 시간이 지나면서 라이브러리들이 어디서 왔으며 아직도 사용하는지 혹은 구 버전을 사용하는지 확인하기 힘들다.

### Shell Scripts to the Rescue?(셀 스크립트가 구할 수 있는가?)

취미로 매우 단순한 프로젝트를 하고 있따고 가정해보자. 빌드 시스템 없이 스크립트만으로 문제를 해결할 수 있다고 생각할 수 있다. 하지만 이는 단기적으로 도움이 될 수 있어도 더 많은 문제를 마주하게 될 것이다.

- 코드가 복잡해지면서, 스크립트에 나오는 문제를 해결하는데 시간이 실제 코드를 작성하는 시간과 비등해질 것이다.
- 느리다. 실수로 오래된 라이브러리에 의존하지 않기 위해서 모든 디펜던시를 순서대로 실행한다.
- 하드 드라이브가 충돌했다. 이제 시스템 재생성 필요! 다운로드한 라이브러리 다 찾을 수 있나요? 설정한 모든 환경 변수는 기억합니까?
- 더 많은 엔지니어를 고용해서 문제를 더 이상 큰 문제가 발생하지 않게됐다. 하지만 새로운 개발자가 팀에 합류할 때마다 프로세스 진행이 필요하고 모든 개인의 시스템에는 작은 차이가 있다. 한 사람의 기계에서 작동하는 것이 다른 사람 것에서는 작동하지 않는다.
- 프로젝트가 커질수록 빌드 속도는 느려지고 어느 날 휴가나가 있는 동료의 데스크탑을 보게 된다. 그리고 낭비되는 시간을 계산할 수 있는 방법이 있기를 바란다.

혼자서 몇백줄 정도의 코드를 작성한다면(당신이 각 대학교를 졸업한 사람이고) 컴파일러로도 크게 문제가 없다. 하지만 프로젝트가 커지고 다양한 개발자들이 함께 하게 된다면 이 단순한 접근방식은 통하지 않는다. 이제 진짜 빌드 시스템에 투자할 시간이다.

### Modern Build Systems(현대 빌드 시스템)

다행히도 앞에서 살펴본 문제는 현존하는 범용 빌드 시스템이 잘 해결가능. 범용 빌드 시스템들은 앞서 이야기한 스크립트 기법 해반과 크게 다르지 않다. 다행인 점은 빌드 시스템들은 오랫동안 개발되어 와서 여러분이 작성하는 스크립트보다 훨씬 견고하고 유연할 것이다.

### It’s All About Dependencies(핵심은 의존성이다)

앞서 언급된 문제를 보면 알겠지만 코드를 관리하는 것은 쉽다. 하지만 외부 디펜던시를 관리하는 것이 어렵다. 하짐 “이걸 하려면 저게 필요해"라는 아이디어는 빌드 시스템 설게에서 반복되고 디펜던시를 관리하는 것이 빌드 시스템의 근본적이 일이다.

### Task-Based Build Systems(테스크 기반 빌드 시스템)

테스크 기반 빌드 시스템의 기본 작업 단위는 태스크이다. 각 테스크는 모든 논리를 실행할 수 있는 일종의 스크립트이다.  그리고 테스크들은 다른 테스크를 먼저 실행해야 하는 디펜더시로 지정한다.

**The dark side of task-based build systems (테스크 기반 빌드 시스템의 단점)**

테스크 기반 빌드 시스템은 엔지니어가 어떤 스크립트도 테스크로 정의할 수 있다. 엔지니어가 상상할 수 있는 모든 것을 할 수 있다. 이는 큰 단점이 있는데 스크립트가 점점 더 복잡해지면서 테스크 기반 빌드 시스템은 어려워 질 수 있다. 이는 시스템에 너무 적은 파워를 주고 엔지니어에게 너무 큰 힘을 줬기 때문이다. 시스템은 스크립트가 무엇을 하고 있는지 모르기 때문에 수정이 힘들다.

**빌드 단계들을 병렬로 실행하기 어렵다**

요즘은 멀티코어가 기본이여서 몇 개의 빌드 단게를 병렬로 실행할 수 있다. 태스크 A가 태스크 B와 C에 의존한다고 해보자. B와 C를 서로 의존하지 않게 정의했다면 A도 더 일찍 끝마치게 해도 안전할까? 같은 자원을 사용하는 게 없다면 안전할 것이다. 하지만 실제 구현시 상태 추적에 같은 파일을 사용하여 충돌이 생길 수도 있다. 이런 사실을 시스템이 알아낼 수 있는 방법은 없다. 따라서 병렬로 빌드하는 이점을 누리지 못할 뿐더러 분산 빌드는 꿈도 못꾼다.

### Conclusion(결론)

빌드 시스템은 엔지니어링 조직에서 가장 중요한 것 중 하나이다. 각각의 개발자들이 수십번에서 수백번 매일 사용하게 된다. 이번 챕터에서 말해듯이 구글이 배운 교훈 중 놀라운 것은 엔지니어의 파워와 유연성을 제한하는 것이 그들의 생산성을 향상 시킬 수 있다는 것이다. 우리는 엔지니어에게 자율적으로 (코드를) 빌딩할 수 있도록 하는 것이 아닌, 개인의 선택을 제한하고 자동화된 툴에서 가장 흥미로운 결정들을 제공하는 높게 구조화 된 틀을 개발함으로 인해 우리의 원하는 목적들을 달성할 수 있었다. 

## 핵심 정리

- 개발자의 생산성을 위해 제대로 된 빌드 시스템 반드시 필요
- 빌드 시스템에 적절한 제한이 오히려 개발자를 더 편하게 함
- 아티팩트 중심 빌드 시스템이 태스크 중심 빌드 시스템보다 확장성, 안정성 면에서 뛰어남
- 아티팩트 의존성을 정의할 때 모듈을 작게 나누는 게 유리
- 외부 의존성의 버전도 명확하게 관리해야 함. 단순하게 ‘최신’ 버전에 의존할 경우 재현할 수 없는 빌드의 늪에 빠지기 쉬움
