
# Chapter 17 - Code Search

</br>

Code Search란, 프론트 엔드 UI와 다양한 백앤드 요소로 구성된 구글의 코드를 검색하는 툴을 말한다.  


이번 챕터에서는 어떻게 구글이 일하면서 Code Search를 사용하는지, 왜 코드를 찾기 위한 별도의 프로그램을 개발하는지, 구글과 같이 큰 코드베이스에서 코드서치하는것이 얼마나 어려운지에 대해 자세히 알아본다.

</br>

---

</br>

## The Code Search UI

![Code Searching UI](/images/chapter17-code_searching_image1.png)

+ 구성 1 : Search Box
+ 구성 2 : Search Suggestion (폴더를 같이 표시해 줌)
+ 구성 3 : Ranking and Code Snippet with High-light
+ 구성 4 : 어떤 파일을 켰을 때, 변수, 함수들을 선택하면 정의를 보여줌 
+ 구성 5 : 파일의 히스토리를 보여줌 (ex. 이전 버전 파일)

</br>

--- 

</br>

## How Do Googlers Use Code Search?

</br> 

### Where?

코드상에서 특정한 정보가 <b>어디</b>있는지 찾을 때 사용한다.  
또한, Code Search에서는 링크전달과 같이 동료들에게 쉽게 검색결과를 공유할 수 있는 기능을 제공함.

</br>

### What?

코드가 <b>무슨</b> 동작을 하는지 찾을 때 사용한다.  
보통, 코드 변경전에 코드 동작에 대해 이해하거나 다른사람들이 무슨 의도를 갖고 코드를 바꿨었는지  
이해하기 위해 사용한다.

Code Search에서는 이런 작업을 쉽게하기 위해 계층구조(헤더, 구현, 빌드 파일)의 빠른 탐색 기능을 제공함.

</br>

### How?

어떤 특정 API에 대해 <b>어떻게</b> 그것을 활용하는지 찾기 위해 사용한다.  
예를 들면 어떤 계산을 하는 라이브러리를 사용하고 싶을때,  
적절히 구현된 것을 검색하여 내가 구현할 부분에 어떻게 적용할지 예시로 참고할 때 사용함.

</br>

### Why?

특정한 코드가 왜 추가돼었는지, 왜 이런 방식으로 동작하고 있는지를 찾기 위해 사용한다.  
보통 디버깅하면서 코드를 이해하기 위해 사용함. 

</br>

### Who and When?
누가 언제 이 코드를 수정했고 추가했는지를 확인하기 위해 사용한다.

</br>

> 구글에서는 <b>코드를 검색하거나, file을 보거나, 코드 자체를 이해하기 위해서 
Code Search를 사용</b>하고,  
그렇기 때문에 Task 엔지니어들은 Code Search를 보는것만으로 가지고 있던 질문에 대한 답이 되게 하거나,  
코드의 의도를 보이게 하려고 노력한다고 한다.

</br>

---

</br>


## Why a Separate Web Tool?

</br>

### 1. Scale

구글의 코드는 매우 커 다음과 같은 문제점이 있다.

+ 1. IDE를 사용하기 위해서는 IDE의 기본 전제 조건인 전체 코드를 포함해야 한다.
+ 2. 로컬 검색 및 인덱스 검색을 위해 환경 구축을 하는 비용(?)이 든다는 점 
+ 3. 전체 코드를 포함한다고 하더라도, IDE가 매우 느리게 동작함

</br>

### 2. Zero Setup Global Code View  

Code Search UI를 사용하면 설정(프로젝트 설명, 빌드 환경)이 필요하지 않으므로 매우 쉽고 빠르게 코드를 배울 수 있고, 코드 종속성이 누락될 위험이 없어 개발 효율성이 향상시킬 수 있다.

(Web에서는 모든 코드가 올라와있기 때문에, 디팬던시나 환경 setup이 필요하지 않음.)

</br>

### 3. Specialization

코드를 이해하거나 검색하는데 Code Search를 사용하는 사람들에 맞게 최적화 할 수 있다.

</br>

### 4. Integration with Other Developer Tools

다른 소스코드를 보는데 사용될 수 있다.  

</br>

### 5. API Exposure

Code Search는 상호 참조 및 구문 강조와 같은 API를 사용할 수 있게 한다. 
따라서, 개발자는 이러한 API 기능을 다시 구현할 필요 없이 사용할 수 있다.

</br>

---

</br>

여기서부터는 Code Search를 구현과 관련된 부분을 설명하고 있다.

</br>

## Impact of Scale on Design

Code Search를 구현하는데 있어 코드베이스의 크기는 해당 Code Search를 효율적으로 동작하는  
구조를 설계하는데 영향을 주었다.

구글의 Code Search의 경우 클라우드 호스팅 솔루션을 활용해 큰 코드베이스에서도  
     코드 검색시간을 합리적으로 유지했다.

    Scale  
    ~10MB : grep 검색을 통한 브루트 방식의 검색방식 사용  
    ~1000MB : index keyword 검색방식 사용  
    ~GB ~ TB : 클라우드 호스팅 솔루션을 통해 검색시간을 합리적으로 유지   


</br>

### Search Query Latency

구글의 Code Search에서는 검색 쿼리를 수행하는 시간을 200ms가 넘지않는 것을 목표로 한다.  
이를 위해, 트리구조로 검색하는 방법보다 기호를 검색하도록하고, 특정 정보(파일 위치 등)를 제공하여 보다 빠르게 원하는 파일, 정보에 접근할 수 있도록 하여 검색속도를 빠르게 수행하도록 했다. 

</br>

### Index Latency

Code Search에서는 수정된 코드에 대해 즉각적으로 인덱싱을 해서 개발자들이  
개발하는데 있어 혼란을 겪지 않게 하도록 한다. 


</br>

## Google’s Implementation

</br>

### Search Index

초기의 Search Index는 접미사 기반의 솔루션을 사용했지만, 구글의 기존 검색, 인덱싱 방식을 활용하기 위해  
token based n-gram 솔루션으로 검색 방식을 변경해 사용하고 있다.

n-gram 방식을 사용하면서, 기존 검색, 인덱싱하는 방식이 발전하면 시너지를 낼 수 있다는 점, 기존 방식보다 메모리 사용량도 줄일 수 있다는 장점을 얻을 수 있었다.


</br>

### Ranking

Ranking은 일반적으로 검색키워드에 대한 점수를 매김으로써 동작한다. 

+ 쿼리 독립 : 쿼리 독립은 검색키워드를 포함하는 파일이 참조되는 수가 많거나, 해당 파일이 검색 키워드를 많이 포함하면 점수를 높게한다. 위와 같은 것을 고려하는 것을 쿼리 독립이라 한다.

+ 쿼리 의존 : 사용자가 검색을 많이 한것을 토대로 점수를 높게한다. 위와 같은 것을 고려하는 것을 쿼리 의존이라고 한다.


</br>

## Selected Trade-Offs

Code Search를 구현하는데 있어 검색 속도를 빠르게 하기 위해서는 다양한 트레이드 오프가 있었는데 그것에 대한 설명이다.

</br>

### Completeness: Repository at Head
대용량의 코드베이스상에서 인덱스가 늘어날수록 당연히 검색속도가 느려지게 된다.  
따라서, Code Search에서는 이미지나 바이너리와 같이 사람이 읽을수 없는 것을    Index에서 제외시켰다.  
개발자가 개발을 하면서 Index에서 제외된 것을 볼 수 없다는 단점이 있지만,  
속도 측면에서 Index를 제거하는것이 좋은 Trade off였다고 한다.

</br>

### Completeness: All Versus Most-Relevant Results

개발자들은 리팩토링을 하는 경우 관련된 모든 코드들을 보고싶어할 수 있다.
이렇게 모든 경우를 검색하게 되면 검색속도가 매우 느려지게 되는데, 이런 특별한 경우를 위해서 검색속도를 낮추는 것보다, 평균적으로 관련된 상위 결과들만 노출시켜 검색속도를 빠르게 하는 것을 Trade off하였다.

</br>

### Completeness: Head Versus Branches Versus All History Versus Workspaces

레포지토리의 여러버전들을 인덱싱하는것은 어렵지만, 인덱싱을 하게 하므로써 코드가 어떻게 변경되었는지 확인하고, 삭제된 코드들을 찾을 수 있게 했다. 

</br>


</br>
---

## Conclusion

개발을 하는데 있어 가장 중요한 것 중 하나는 코드를 이해하는 것이라고 독자는 말한다.  
그것을 위해 투자하는 것이 매우 어렵지만 정말 많이 사용될 것이고, 개발에 드는   
리소스 대비 분명한 이익을 가져다 줄 것이라고 말하고 있다.

</br>

> 내가 이해한 Code Search Chapter는 구글에서 사용하는 개발 도구 중 하나를 소개한 것으로 이해를 했고,  우리 회사에서의 필요성은 사실 크게 느끼진 못했다.  

> Code Search 내용에서 우리 회사에 차용할만한 내용은 구글에서는 Code Search에서 어떤 것을 수정했는지,   
왜 변경했는지에 대한 의도 등이 직관적으로 이해될 수 있도록 코드를 작성하도록 노력한다고 했는데,   
우리 회사에서는 비슷한 맥락에서 git commit을 잘 작성하면 좋을 것 같다고 생각했다. 