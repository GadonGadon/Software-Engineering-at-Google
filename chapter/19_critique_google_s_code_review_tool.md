# Critique : 구글 코드 리뷰 Tool
코드 리뷰의 가장 큰 목적은 코드베이스의 가독성과 유지보수 개선입니다.  코드 리뷰가 부드럽게 잘 동작할 수 있도록 구글 Critique 프로그램에 알아보겠습니다.
## Critique
Critique는 코드리뷰에 가장 필요한 기능, 리뷰어와 작성자에게 코드 리뷰용 화면과 댓글 기능을 제공합니다. 또한 변경에 점수를 매김으로써 코드베이스에 체크인할 코드를 선별하는 게이트 키핑도 지원합니다. 또한, 코드 주석이 없더라도 History를 통해 코드의 변경점을 추적할 수 있습니다.
## 코드리뷰 흐름
![Untitled Diagram drawio](https://user-images.githubusercontent.com/77031554/172541225-702d4383-468e-4f44-b04a-fa05e0eef03b.png)
일반적으로 코드 리뷰는 다음 단계로 진행됩니다.
1. 변경 생성 : 사용자가 개인 작업 공간의 코드 베이스에 변경을 생성합니다.
2. 리뷰 요청 : Critique가 디프와 코드 분석 결과를 보여줍니다. 한명 이상의 리뷰어에게 리뷰 요청 메일을 보냅니다.
3. 댓글 달기 : 리뷰어들은 Critique에서 변경 사항을 열어보고 댓글 초안을 작성합니다. 다 작성한 댓글들은 전송(send)를 해야만 작성자가 확인가능합니다.
4. 댓글 답하기 : 작성자가 피드백을 확인하고 답변을 달 수 있습니다. 이때, 작성자는 모든 (unresolved)댓글에 답변을 달아야 합니다. 코드를 수정하든, 대댓글을 달든 관계 없이 무조건 resolved 상태로 댓글들을 바꾸어야 합니다.
5. 변경 승인 : 리뷰어들이 변경에 마음이 들면 LGTM(looks good to me)라고 표시합니다. 모두가 만족하면 GUI에 녹색으로 표시됩니다.
6. 변경 커밋 : 변경이 승인되었음을 Critique에 알려주면 커밋 프로세스를 시작할 수 있습니다.
> 이 모든 과정은 Chrome혹은 Gmail 알람으로 확인할 수 있습니다.

## 1. 변경 생성
***변경이력(diff)확인***
코드 리뷰의 핵심은 변경사항을 확인하는 것입니다. Critique는 변경사항을 손쉽게 확인할 수 있도록 합니다.
![Selection_064](https://user-images.githubusercontent.com/77031554/172542628-2fdaf482-5a78-4fd7-b220-d8d86835569e.png)

- 구문 강조
- 상호 참조
- 공백 무시 옵션 제공
- 인트라인 디프 : 줄바꿈이나 공백과 상관없이 문자 수준으로 분해해 변경점을 보여줌
- 이동 검출 : 코드 덩어리가 이동만 한 겨우 moved라고 표시
Critique는 파일의 변경 이력을 UI로 제공합니다. 해당 스냅샷을 통해 코드 리뷰 수신 여부, 댓글이 달렸는지 등을 확인할 수 있습니다.
***분석 결과***
스냅샷을 업로드하면 코드 분석이 시작됩니다.
![Selection_066](https://user-images.githubusercontent.com/77031554/172544493-c57a432c-09bf-4492-b2e1-f87891b9c15b.png)
Critique는 변경 페이지에 분석결과를 함께 보여주게 됩니다. Analysis탭을 누를 경우 상세 내용을 보여줍니다.
각 분석기들은 중요사항을 붉게 표현하며, 분석 수행중인 분석기들은 노란색, 그 이외는 노란색으로 표현됩니다. 

> 예를들어 Linter에 줄 끝에 공백이 있으면 안된다는 스타일 규칙을 위반한 코드를 찾은 경우, 변경페이지에 이 항목이
> 표시되고 작성자는 클릭하여 해당 코드로 갈 수 있습니다. 이후, 해당 항목을 다시 누르면 수정 제안이 적용된 미리보기를 확인할
> 수 있고 한 번 더 누르면 수정 제안 사항을 코드에 반영할 수 있습니다.

***추가적인  Tool***

 - Cider : 클라우드에 저장된 소스 코드를 편집하는 온라인 IDE
 - Code Search : 코드 베이스의 코드를 검색하는 도구
 - Tricoder : 정적 분석 결과를 보여주는 도구 (앞 내용에 사용됨)
 - Rapid : 일련의 변경을 포함하는 바이너리를 묶어 배포하는 릴리스 도구
 - Zapfhahn : 테스트 커버리지 계산 도구

Critique는 위의 다양한 도구들을 통해 원클릭으로 코드베이스를 리뷰할 수 있도록 돕습니다.

## 2. 리뷰 요청 
![Selection_067](https://user-images.githubusercontent.com/77031554/172549063-57cadd7d-781d-4c88-aea2-05548d2cc017.png)
Critique는 다음과 같이 리뷰어를 할당할 수 있습니다. 이때 리뷰어를 할당할 떄는

 - 수정되는 코드의 소유자는?
 - 해당 코드를 가장 잘 아는 사람(최근 수정한 사람)
 - 리뷰할 여건을 가진 사람(동일 시간대에 근무)
 
 위와 같은 사항들을 고려해 선정해야합니다. 리뷰어를 선정하면 동시에 변경과 관련된 프리커밋 훅이 실행되고 만약 훅이 실패했다면 작성자에게 메일로 알려주며 리뷰어에게 리뷰요청이 전송되지 않습니다.
## 3~4. 변경 이해하고 댓글 달기
***댓글달기***
리뷰 프로세스가 시작되면 작성자와 리뷰어는 고품질의 변경만을 커밋한다는 공통된 목표를 향해 작업해야합니다.
![Selection_068](https://user-images.githubusercontent.com/77031554/172549982-9d8296b9-0b2d-4d56-94e3-bed79ceb1b76.png)

댓글달기의 경우 사용자 누구든 댓글을 달 수 있습니다.
![Selection_069](https://user-images.githubusercontent.com/77031554/172558805-aa318954-6605-4b6c-9dc6-44761870a669.png)
이때, reviewed 체크박스가 리뷰어별로 제공되기 때문에 리뷰어들은 각자가 자신이 어디까지 확인했는지 알 수 있습니다. 또한, please fix 버튼을 클릭하여 미해결 댓글을 추가할 수 있습니다.

이렇게 남긴 댓글들은 초안으로 계속 쌓이다가 send 버튼을 누르면 한번에 전송됩니다.
![Selection_070](https://user-images.githubusercontent.com/77031554/172559276-08ce3cd7-8353-417a-ac31-9557b342dc4e.png)

***변경 상태 확인하기***
3,4 단계를 반복하는 과정에서 어디가 변경됐는지 아는 것은 중요합니다. Critique는 해당 기능을 대쉬보드로써 제공합니다.

 - Attention Set : 해당기능은 리뷰어들이 해당 관심 집단에 속해있다면 반드시 응답하도록 합니다. 이때 최소 1명 이상 답해야합니다.
 - Dash board : 대쉬보드에서 변경이력은 검색할 수 있으며 리뷰어들의 변경사항들은 요약되어 한눈에 볼 수 있습니다.
![Selection_071](https://user-images.githubusercontent.com/77031554/172559950-7321f305-4017-414d-a7fc-94859e78cb0b.png)

## 5. 변경 승인하기
변경 승인은 점수로서 메겨질 수 있습니다.
 - LGTM
 - 승인
 - 미해결 댓글

 LGTM은 리뷰어가 변경을 검토한 결과 커밋해도 좋다는 도장입니다. 승인은 리뷰어가 해당 변경사항을 커밋할 수 있도록 허락한다는 뜻이며, 만약 미해결(unresolve)상태이면 작성자가 확인하라는 뜻입니다.
 LGTM이 하나 이상, 충분한 수의 승인, 미해결 댓글이 0이라면 작성자는 해당 변경 사항을 커밋할 수 있습니다. 모든 변경에는 LGTM이 반드시 필요합니다. 즉, 커밋하기전 적어도 1명이상의 확인을 거쳐야 하는 것입니다.
 Analysis탭에는 점수 패널이 있으며 
 

 - LGTM을 찍은 사람
 - 변경이 필요한 사항과 이유
 - 미해결 댓글 수
 
 의 정보들을 표현해주며 이를 점수화 해 작성자가 해야할 일을 빠르게 이해할 수 있도록 합니다.
 
## 6. 변경 커밋
***변경 이력 추적***
Critique는 커밋 버튼을 제공하며 터미널에서 명령어를 칠 필요가 없습니다. Critique는 커밋 직전 변경사항들을 추적할 수 있도록 하며, 커밋 이후에도 계속해서 해당 변경 사항에 대해 댓글을 달 수 있도록 합니다. 또한, Critique는 롤백기능을 제공합니다.

## Critique같은 코드 리뷰 프로그램의 필요성
코드 리뷰에 쓰이는 시간은 코드를 생산하지 못하는 시간입니다. 따라서 리뷰 프로세스를 최적화하면 그만큼 회사의 생산성이 개선됩니다.
리뷰에 드는 시간을 줄이려면 코드 리뷰 프로세스가 막힘없이 흘러야 하며, 주목해야할 변경 사양들을 사용자에게 간단명료하게 알려주고 분석기나 통합등에서 포착함 잠재적 문제들을 알려주어야 합니다.

구글은 표준 프로세스를 Critique로 단순화하여 유지 중이며 큰 효과를 거두고 있습니다.

